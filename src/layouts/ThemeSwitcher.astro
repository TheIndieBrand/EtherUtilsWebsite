<div class="theme-switcher">
    <button id="theme-btn" class="theme-btn" aria-label="Cambiar tema">
        <i class="bi bi-sun-fill theme-icon"></i>
    </button>
</div>

<style>
    .theme-switcher {
        position: fixed;
        top: 1.5rem;
        right: 1.5rem;
        z-index: 1000;
    }

    .theme-btn {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        border: 2px solid var(--accent);
        background: var(--ground);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .theme-btn:hover {
        transform: scale(1.1) rotate(15deg);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
    }

    .theme-btn:active {
        transform: scale(0.95);
    }

    .theme-icon {
        font-size: 1.5rem;
        color: var(--accent);
        transition: transform 0.3s ease;
    }

    .theme-btn:hover .theme-icon {
        transform: rotate(180deg);
    }
</style>

<script>
    const themeBtn = document.getElementById('theme-btn');
    const themeIcon = themeBtn?.querySelector('.theme-icon');

    const themes = ['light', 'dark', 'ash'];
    const icons = {
        light: 'bi-sun-fill',
        dark: 'bi-moon-stars-fill',
        ash: 'bi-cloud-fog-fill'
    };

    function getInitialTheme() {
        const saved = localStorage.getItem('theme');
        if (saved && themes.includes(saved)) return saved;

        return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
    }

    let currentTheme = getInitialTheme();

    function applyTheme(theme: string) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('theme', theme);

        if (themeIcon) themeIcon.className = `theme-icon ${icons[theme as keyof typeof icons]}`;
    }

    function cycleTheme() {
        const currentIndex = themes.indexOf(currentTheme);
        const nextIndex = (currentIndex + 1) % themes.length;
        currentTheme = themes[nextIndex];
        applyTheme(currentTheme);
    }

    applyTheme(currentTheme);

    themeBtn?.addEventListener('click', cycleTheme);
</script>